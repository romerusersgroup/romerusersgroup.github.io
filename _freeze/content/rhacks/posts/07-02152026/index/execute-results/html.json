{
  "hash": "e7488678f88d2d74a0b33f0d7383bdc0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Stop Copy‚ÄìPasting. Start Iterating.\"\nsubtitle: \"Making a loop (when and how to do it properly)\"\ndescription: \"R-Hacks N.7\"\nauthor: \"Federica Gazzelloni\"\ndate: \"15 February 2026\"\nimages: \"images/image-1.png\"\nseries: R-Hacks\ncategories:\n  - workflows\n  - iteration\n  - programming\nlayout: single\ntoc-location: left\ntoc: true\ncode-overflow: wrap\nexecute:\n  warning: false\n  message: false\n---\n\n<br>\n\n![Stop Copy‚ÄìPasting. Start Iterating (ChatGPT generated image)](images/image-1.png){width=\"80%\" fig-align=\"center\" fig-alt=\"ChatGPT generated image\"}\n\n**After fixing structure (N.3), adding sanity checks (N.5), and reshaping data properly (N.6), the next natural step is iteration over clean data.**\n\nIn R, [**the problem is rarely how to write a loop**]{.underline}. The real question is:\n\n> **When should you loop ‚Äî and when should you not?**\n\nThis R-Hack focuses on replacing duplication with controlled iteration.\n\n## The Core Problem: Duplication\n\nYou see code like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(df$var1)\nmean(df$var2)\nmean(df$var3)\n```\n:::\n\n\nOr:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(df$year_2020)\nplot(df$year_2021)\nplot(df$year_2022)\n```\n:::\n\n\n**It works.**\n\n::: {.callout-note appearance=\"simple\"}\n-   But it does not scale\n-   It is fragile\n-   And it invites mistakes\n:::\n\n> [**Duplication is your signal that iteration may be appropriate.**]{.underline}\n\n### Step 1 ‚Äì Simulate Example Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\n\ndf <- data.frame(\n  var1 = rnorm(100),\n  var2 = rnorm(100, mean = 2),\n  var3 = rnorm(100, mean = 4)\n)\n\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         var1     var2     var3\n1 -0.56047565 1.289593 6.198810\n2 -0.23017749 2.256884 5.312413\n3  1.55870831 1.753308 3.734855\n4  0.07050839 1.652457 4.543194\n5  0.12928774 1.048381 3.585660\n6  1.71506499 1.954972 3.523753\n```\n\n\n:::\n:::\n\n\n### Step 2 ‚Äì A Clean for Loop\n\nInstead of repeating logic, define the variables once.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvars <- names(df)\n\nfor (v in vars) {\n  print(mean(df[[v]], na.rm = TRUE))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.09040591\n[1] 1.892453\n[1] 4.120465\n```\n\n\n:::\n:::\n\n\nThis loop:\n\n-   iterates over column names\n-   extracts values using \\[\\[ \\]\\]\n-   avoids copy‚Äìpaste\n-   keeps logic consistent\n\nSimple and readable.\n\n### Step 3 ‚Äì Storing Results Properly (Preallocation)\n\nIf you need results for later use, preallocate.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresults <- numeric(length(vars))\n\nfor (i in seq_along(vars)) {\n  results[i] <- mean(df[[vars[i]]], na.rm = TRUE)\n}\n\nresults\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.09040591 1.89245320 4.12046511\n```\n\n\n:::\n:::\n\n\nWhy preallocate?\n\n-   avoids growing objects inside the loop\n-   keeps structure explicit\n-   improves clarity and performance\n\n> [**Preallocation is not about micro-optimisation. It is about good structure.**]{.underline}\n\n### Step 4 ‚Äì Plotting Without Copy‚ÄìPaste\n\n‚ùå The Copy‚ÄìPaste Pattern\n\n\n::: {.cell layout-ncol=\"3\"}\n\n```{.r .cell-code}\nplot(df$var1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$var2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$var3)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n:::\n\n\nThis works ‚Äî but does not scale.\n\n‚úÖ Base R Loop\n\n\n::: {.cell layout-ncol=\"3\"}\n\n```{.r .cell-code}\nfor (v in vars) {\n  hist(df[[v]],\n       main = paste(\"Histogram of\", v),\n       col = \"steelblue\")\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-3.png){width=672}\n:::\n:::\n\n\nThis produces one histogram per variable.\n\n‚úÖ ggplot2 Loop (Important Detail)\n\n\n::: {.cell layout-ncol=\"3\"}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nfor (v in vars) {\n  p <- ggplot(df, aes(x = .data[[v]])) +\n    geom_histogram(fill = \"steelblue\", bins = 20) +\n    labs(title = paste(\"Histogram of\", v)) +\n    theme_minimal()\n\n  print(p)\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-3.png){width=672}\n:::\n:::\n\n\n::: {.callout-note appearance=\"simple\"}\n**üîé Important**: `print(p)` is required inside loops. Without it, nothing is displayed.\n:::\n\nThis is a subtle but crucial detail many users miss.\n\n## When Not to Loop\n\nIf you are looping over columns, pause. Ask:\n\n> [**Should the data be long instead?**]{.underline}\n\nFor example [(see R-Hacks N.6)](https://romerusersgroup.github.io/content/rhacks/posts/06-02082026/):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\n\ndf_long <- df |>\n  pivot_longer(\n    cols = everything(),\n    names_to = \"variable\",\n    values_to = \"value\"\n  )\n\nggplot(df_long, aes(value)) +\n  geom_histogram(bins = 20, fill = \"steelblue\") +\n  facet_wrap(~ variable, scales = \"free\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n\nSometimes reshaping simplifies everything more than iterating.\n\n## Editorial Stance\n\nLoops are not bad. Copy‚Äìpaste is worse.\n\nThe goal is not to write clever code. The goal is to write less duplicated code.\n\nIteration becomes powerful when:\n\n-   structure is clean\n-   shape is correct\n-   logic is stable\n\n::: {.callout-note appearance=\"‚Äúsimple‚Äù\"}\nIn Short\n\n-   Duplication is a signal\n-   Replace repetition with controlled iteration\n-   Preallocate when storing results\n-   Remember print() inside ggplot loops\n-   If you are looping across columns, reconsider the data shape\n:::\n\nIteration is not about complexity. It is about discipline.\n\n::: callout-tip\nIf you want to stay up to date with the latest events and posts from the Rome R Users Group:\n\nüëâ https://www.meetup.com/rome-r-users-group/\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}