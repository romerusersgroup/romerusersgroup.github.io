{
  "hash": "beba0aee12018502fe617423dfda4984",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"When to Pivot: Spotting Data Shape Problems Early\"\nsubtitle: \"A small structural decision that simplifies everything downstream\"\ndescription: \"R-Hacks N.6\"\nauthor: \"Federica Gazzelloni\"\ndate: \"08 February 2026\"\nimages: \"images/image-1.png\"\nseries: R-Hacks\ncategories:\n  - data-wrangling\n  - workflows\n  - tidyr\nlayout: single\ntoc-location: left\ntoc: true\ncode-overflow: wrap\nexecute:\n  warning: false\n  message: false\n---\n\n<br>\n\n![Wide vs long data illustration (ChatGPT generated image)](images/image-1.png){width=\"80%\" fig-align=\"center\" fig-alt=\"ChatGPT generated image\"}\n\n\n### If your code feels harder than it should be, the problem is often not your logic.\n\n> It's the shape of your data.\n\nThis R-Hack focuses on a common but under-diagnosed issue: delaying reshaping, then compensating with complex code. Learning to recognise early signals that data should be pivoted can dramatically simplify summaries, plots, and models.\n\n\n### What *\"data shape\"* means (in practice)\n\nForget theory. In practice, data shape answers one question:\n\n> What is an observation?\n\nIf an observation is:\n\n- a person at a time point\n- a measurement of a variable\n- a categoryâ€“value pair\n\nthen your data should reflect that row by row.\n\n\n:::{.callout-note appearance=\"simple\"}\n\nA quick rule of thumb:\n\nIf you are repeating the same operation across multiple columns, your data likely wants to be long.\n\n:::\n\n\n## Early warning signs you should pivot\n\nIf you see any of the following, pause and consider reshaping:\n\n- `mutate()` or `summarise()` repeated across many columns\n- `across(starts_with(...))` doing heavy lifting\n- `ggplot` code that manually references multiple variables\n- column names encoding values (e.g. sales_2022, sales_2023)\n- copyâ€“paste patterns that differ only by column name\n\nThese are shape problems, not syntax problems.\n\n\n## A minimal example\n\nLet's simulate a small, tidy-looking dataset that is actually awkward to work with.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\n\ndf_wide <- data.frame(\n  id = 1:5,\n  glucose_morning = c(110, 98, 130, 105, 120),\n  glucose_evening = c(140, 115, 160, 125, 150)\n)\n\ndf_wide\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id glucose_morning glucose_evening\n1  1             110             140\n2  2              98             115\n3  3             130             160\n4  4             105             125\n5  5             120             150\n```\n\n\n:::\n:::\n\n\n:::{.callout-note appearance=\"simple\"}\n\nAt first glance, this looks fine. But now try to:\n\n- compute summaries\n- make a single plot\n- compare morning vs evening values\n\n:::\n\n\nEverything becomes more complicated than necessary.\n\n\n## Pivot once, simplify everything\n\nA single `pivot_longer()` changes the workflow completely.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_long <- df_wide |>\n  pivot_longer(\n    cols = starts_with(\"glucose\"),\n    names_to = \"time\",\n    values_to = \"glucose\"\n  )\n\ndf_long\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 Ã— 3\n      id time            glucose\n   <int> <chr>             <dbl>\n 1     1 glucose_morning     110\n 2     1 glucose_evening     140\n 3     2 glucose_morning      98\n 4     2 glucose_evening     115\n 5     3 glucose_morning     130\n 6     3 glucose_evening     160\n 7     4 glucose_morning     105\n 8     4 glucose_evening     125\n 9     5 glucose_morning     120\n10     5 glucose_evening     150\n```\n\n\n:::\n:::\n\n\nNow each row is a measurement, not a column variant.\n\n\n> See the payoff immediately\n\n### Summaries become simpler\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_long |>\n  group_by(time) |>\n  summarise(\n    n = n(),\n    mean_glucose = mean(glucose)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 Ã— 3\n  time                n mean_glucose\n  <chr>           <int>        <dbl>\n1 glucose_evening     5         138 \n2 glucose_morning     5         113.\n```\n\n\n:::\n:::\n\n\n### Plots become trivial\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(df_long, aes(x = time, y = glucose)) +\n  geom_boxplot() +\n  labs(\n    title = \"Glucose levels by time of day\",\n    x = NULL,\n    y = \"Glucose\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n- No manual aesthetics\n- No duplicated code\n- No workarounds\n\n\n> When not to pivot\n\nNot everything should be long.\n\n:::{.callout-note appearance=\"simple\"}\n\nAvoid pivoting when:\n\n- columns represent different concepts (e.g. age vs height)\n- you are producing final reporting tables\n- identifiers would be duplicated unnecessarily\n\n:::\n\nPivoting is a tool, not a rule.\n\n\n## Making this a habit\n\nBefore adding complexity, ask:\n- Am I repeating the same logic across columns?\n- Am I fighting ggplot instead of feeding it clean data?\n- Are column names doing the job rows should be doing?\n\nIf the answer is *\"yes\"*, try reshaping early.\n\n\n:::{.callout-note appearance=\"simple\"}\n\nIn short\n\n- Many messy workflows start with data in the wrong shape\n- Shape problems masquerade as logic problems\n- One early pivot can remove dozens of lines of code\n- Decide structure early, then move on\n\n:::\n\nThis is not about writing more code.\nIt's about writing less.\n\n\n## Industry update (short note)\n\nPosit has opened a private beta of an AI assistant embedded directly in `RStudio.`\nIf you're curious to try it, you can join the waiting list here:\n\nðŸ‘‰ <https://posit.co/products/enterprise/ai/>\n\n\n:::{.callout-tip}\n\nIf you want to stay up to date with the latest events and posts from the Rome R Users Group, follow us here:\n\nðŸ‘‰ <https://www.meetup.com/rome-r-users-group/>\n\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}